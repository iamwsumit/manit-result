<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Student Marks Portal</title>

    <meta
      property="og:title"
      content="Student Marks Portal - View Your Results"
    />
    <meta
      property="og:description"
      content="A secure way to access and view your semester results and academic performance. Check your grades, marks, and SGPA with ease."
    />
    <meta property="og:type" content="website" />
    <meta
      property="og:image"
      content="https://manitfirst.web.app/assets/manit.png"
    />
    <meta
      property="og:url"
      content="https://iamwsumit.github.io/manit-result/"
    />

    <link rel="stylesheet" href="common.css">

    <style>
      @import url("https://fonts.googleapis.com/css2?family=Rubik:wght@300..900&display=swap");
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
        font-family: "Segoe UI", "Rubik", Tahoma, Geneva, Verdana, sans-serif;
      }

      .stats-button {
        background: var(--primary-color);
        color: white;
        padding: 10px 20px;
        border: none;
        border-radius: 5px;
        font-size: 0.9rem;
        font-weight: 500;
        cursor: pointer;
        text-decoration: none;
        display: inline-block;
        margin-top: 10px;
      }

      .stats-info-section {
        background: var(--card-color);
        border: 1px solid #e0e0e0;
        border-radius: 5px;
        padding: 15px;
        margin-top: 15px;
        text-align: center;
        box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
      }

      .stats-info-section h3 {
        margin-bottom: 8px;
        font-size: 1.1rem;
        color: var(--text-color);
      }

      .stats-info-section p {
        margin-bottom: 10px;
        font-size: 0.9rem;
        color: var(--text-color);
      }

      :root {
        --primary-color: #3498db;
        --secondary-color: #2ecc71;
        --accent-color: #f39c12;
        --background-color: #f8f9fa;
        --card-color: #ffffff;
        --text-color: #333333;
        --error-color: #e74c3c;
      }

      body {
        background-color: var(--background-color);
        color: var(--text-color);
        min-height: 100vh;
        padding: 2rem;
        display: flex;
        flex-direction: column;
        align-items: center;
      }

      .container {
        width: 100%;
        max-width: 900px;
      }

      .header {
        text-align: center;
        margin-bottom: 2rem;
      }

      .header h1 {
        color: var(--primary-color);
        margin-bottom: 0.5rem;
      }

      .card {
        background-color: var(--card-color);
        border-radius: 10px;
        box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
        padding: 2rem;
        margin-bottom: 2rem;
      }

      .tabs {
        display: flex;
        margin-bottom: 1.5rem;
        border-bottom: 1px solid #e0e0e0;
      }

      .tab {
        padding: 0.75rem 1.5rem;
        cursor: pointer;
        transition: all 0.3s;
        border-bottom: 2px solid transparent;
      }

      .tab.active {
        border-bottom: 2px solid var(--primary-color);
        color: var(--primary-color);
        font-weight: bold;
      }

      .form-section {
        display: none;
      }

      .form-section.active {
        display: block;
      }

      .form-group {
        margin-bottom: 1.5rem;
      }

      .form-group label {
        display: block;
        margin-bottom: 0.5rem;
        font-weight: 500;
      }

      .recommended {
        display: inline-block;
        background-color: var(--accent-color);
        color: white;
        padding: 0.2rem 0.5rem;
        border-radius: 4px;
        font-size: 0.75rem;
        margin-left: 0.5rem;
      }

      .token-extraction {
        background-color: rgba(0, 0, 0, 0.05);
        padding: 0.75rem;
        border-radius: 5px;
        font-family: monospace;
        margin-top: 0.5rem;
        font-size: 0.9rem;
      }

      .form-control {
        width: 100%;
        padding: 0.75rem;
        border: 1px solid #ddd;
        border-radius: 5px;
        transition: border 0.3s;
        font-size: 1rem;
      }

      .form-control:focus {
        border-color: var(--primary-color);
        outline: none;
      }

      .btn {
        background-color: var(--primary-color);
        color: white;
        border: none;
        padding: 0.75rem 1.5rem;
        border-radius: 5px;
        cursor: pointer;
        font-size: 1rem;
        transition: background-color 0.3s;
        width: 100%;
        position: relative;
        overflow: hidden;
      }

      .btn:hover {
        background-color: #2980b9;
      }

      .btn-loading .btn-text {
        visibility: hidden;
      }

      .loading-bar {
        position: absolute;
        top: 0;
        left: 0;
        height: 100%;
        width: 0%;
        background-color: rgba(255, 255, 255, 0.3);
        transition: width 0.3s linear;
      }

      .disclaimer {
        text-align: center;
        font-size: 0.8rem;
        color: #777;
        margin-top: 1rem;
      }

      .error-message {
        color: var(--error-color);
        margin-top: 1rem;
        padding: 0.75rem;
        background-color: rgba(231, 76, 60, 0.1);
        border-radius: 5px;
        display: none;
      }

      .report-card {
        background-color: var(--card-color);
        border-radius: 10px;
        box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
        padding: 2rem;
        margin-top: 2rem;
        display: none;
      }

      .student-info {
        margin-bottom: 1.5rem;
        border-bottom: 1px solid #e0e0e0;
        padding-bottom: 1rem;
      }

      .student-info h3 {
        margin-bottom: 0.5rem;
        color: var(--primary-color);
      }

      .student-info p {
        margin-bottom: 0.5rem;
      }

      .semester-selector {
        margin-bottom: 1.5rem;
        display: flex;
        align-items: center;
        gap: 1rem;
      }

      .semester-selector label {
        font-weight: 500;
        margin-bottom: 0;
      }

      .semester-dropdown {
        flex: 1;
        padding: 0.75rem;
        border: 1px solid #ddd;
        border-radius: 5px;
        background-color: white;
        font-size: 1rem;
        cursor: pointer;
      }

      .semester-dropdown:focus {
        border-color: var(--primary-color);
        outline: none;
      }

      .marks-table {
        width: 100%;
        border-collapse: collapse;
        margin-bottom: 1.5rem;
      }

      .marks-table th,
      .marks-table td {
        padding: 0.75rem;
        text-align: left;
        border-bottom: 1px solid #e0e0e0;
      }

      .marks-table th {
        background-color: rgba(52, 152, 219, 0.1);
        font-weight: 600;
      }

      .marks-table tr:last-child td {
        border-bottom: none;
      }

      .grade-A {
        color: #27ae60;
      }

      .grade-B {
        color: #2980b9;
      }

      .grade-C {
        color: #f39c12;
      }

      .grade-D,
      .grade-F {
        color: #e74c3c;
      }

      .summary {
        margin-top: 1.5rem;
        padding-top: 1rem;
        border-top: 1px solid #e0e0e0;
      }

      .summary p {
        margin-bottom: 0.5rem;
      }

      .print-btn {
        background-color: var(--secondary-color);
        margin-top: 1rem;
        display: inline-block;
      }

      .print-btn:hover {
        background-color: #27ae60;
      }

      @media print {
        body {
          padding: 0;
          background-color: white;
        }

        .container {
          max-width: 100%;
        }

        .card,
        .header {
          display: none;
        }

        .report-card {
          display: block !important;
          box-shadow: none;
          padding: 0;
        }

        .print-btn {
          display: none;
        }
      }

      @media (max-width: 768px) {
        body {
          padding: 1rem;
        }

        .card {
          padding: 1.5rem;
        }

        .tab {
          padding: 0.5rem 1rem;
        }
      }

      .info-box {
        margin-top: 30px;
        padding: 24px;
        background: #f8f9fa;
        border-radius: 8px;
        border-left: 4px solid #2196f3;
      }

      .info-box h3 {
        color: #333;
        margin-bottom: 10px;
        display: flex;
        align-items: center;
        gap: 8px;
      }

      .info-box p {
        color: #666;
        line-height: 1.6;
      }

      button.secondary {
        width: 100%;
        padding: 16px;
        background: white;
        color: #2196f3;
        border: 2px solid #2196f3;
        border-radius: 8px;
        font-size: 1rem;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.3s;
      }

      button.secondary:hover {
        background: #2196f3;
        color: white;
      }

    </style>
  </head>
  <body>
    <div class="container">
      <div class="header">
        <h1>Student Marks Portal</h1>
        <p>View your semester results securely</p>
      </div>

      <div class="card">
        <div class="tabs">
          <div class="tab active" data-tab="login">Login with Credentials</div>
          <div class="tab" data-tab="token">Use JWT Token</div>
        </div>

        <div class="form-section active" id="login-section">
          <div class="form-group">
            <label for="scholar-no">Scholar Number</label>
            <input
              type="text"
              id="scholar-no"
              class="form-control"
              placeholder="Enter your scholar number"
            />
          </div>
          <div class="form-group">
            <label for="password">Password</label>
            <input
              type="password"
              id="password"
              class="form-control"
              placeholder="Enter your password"
            />
          </div>
        </div>

        <div class="form-section" id="token-section">
          <div class="form-group">
            <label for="jwt-token"
              >JWT Token <span class="recommended">Recommended</span></label
            >
            <input
              type="text"
              id="jwt-token"
              class="form-control"
              placeholder="Paste your JWT token here"
            />
            <div class="token-extraction">localStorage.getItem('token')</div>
            <p style="font-size: 0.9rem; margin-top: 0.5rem">
              Run the above code in console of student portal website to get
              your JWT token.
            </p>
          </div>
        </div>

        <div class="form-group">
          <button id="show-marks-btn" class="btn">
            <div class="loading-bar" id="loading-bar"></div>
            <span class="btn-text">Show Marks</span>
          </button>
        </div>

        <div class="error-message" id="error-message"></div>
        <div class="info-box">
          <h3>ðŸ“Š Marks vs Grade</h3>
          <p>
            View grade distribution and marking criteria for all subjects across
            different semesters
          </p>
          <a href="marks-grade.html">
          <button class="secondary" style="margin-top: 15px">
            ðŸ“Š View Marks vs Grade
          </button>
        </a>
        </div>
        <div class="disclaimer">
          <p>
            This site does not collect or store any of your data. All
            information is processed locally in your browser.
          </p>
        </div>
        </div>

        
      </div>

<div class="dev-badge">
        <div class="badge-inner">
            <div class="badge-avatar">SK</div>
            <div class="badge-content">
                <span class="badge-label">Developed by</span>
                <span class="badge-name">Sumit Kumar</span>
            </div>
            <div class="badge-socials">
                <a href="https://github.com/iamwsumit" target="_blank" class="social-icon github" data-tooltip="GitHub">
                    <svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                        <path d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z"/>
                    </svg>
                </a>
                <a href="https://linkedin.com/in/iamwsumit" target="_blank" class="social-icon linkedin" data-tooltip="LinkedIn">
                    <svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                        <path d="M20.447 20.452h-3.554v-5.569c0-1.328-.027-3.037-1.852-3.037-1.853 0-2.136 1.445-2.136 2.939v5.667H9.351V9h3.414v1.561h.046c.477-.9 1.637-1.85 3.37-1.85 3.601 0 4.267 2.37 4.267 5.455v6.286zM5.337 7.433c-1.144 0-2.063-.926-2.063-2.065 0-1.138.92-2.063 2.063-2.063 1.14 0 2.064.925 2.064 2.063 0 1.139-.925 2.065-2.064 2.065zm1.782 13.019H3.555V9h3.564v11.452zM22.225 0H1.771C.792 0 0 .774 0 1.729v20.542C0 23.227.792 24 1.771 24h20.451C23.2 24 24 23.227 24 22.271V1.729C24 .774 23.2 0 22.222 0h.003z"/>
                    </svg>
                </a>
                <a href="mailto:me@sumitkmr.com" class="social-icon email" data-tooltip="Email">
                    <svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                        <path d="M20 4H4c-1.1 0-1.99.9-1.99 2L2 18c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2zm0 4l-8 5-8-5V6l8 5 8-5v2z"/>
                    </svg>
                </a>
            </div>
        </div>
    </div>

      <div class="report-card" id="report-card">
        <div class="student-info" id="student-info"></div>

        <div class="semester-selector">
          <label for="semester-select">Select Semester:</label>
          <select id="semester-select" class="semester-dropdown"></select>
        </div>

        <table class="marks-table" id="marks-table">
          <thead>
            <tr>
              <th>Subject</th>
              <th>Total Marks</th>
              <th>Mid Term</th>
              <th>End Term</th>
              <th>Grade</th>
            </tr>
          </thead>
          <tbody id="marks-table-body"></tbody>
        </table>

        <div class="summary" id="summary"></div>

        <button class="btn print-btn" id="print-btn">Print Report Card</button>
      </div>
    </div>

    <script>
      let allResultData = null;

      document.querySelectorAll(".tab").forEach((tab) => {
        tab.addEventListener("click", () => {
          document
            .querySelectorAll(".tab")
            .forEach((t) => t.classList.remove("active"));
          document
            .querySelectorAll(".form-section")
            .forEach((s) => s.classList.remove("active"));

          tab.classList.add("active");
          document
            .getElementById(`${tab.dataset.tab}-section`)
            .classList.add("active");
        });
      });

      const showMarksBtn = document.getElementById("show-marks-btn");
      const loadingBar = document.getElementById("loading-bar");
      const errorMessage = document.getElementById("error-message");
      const reportCard = document.getElementById("report-card");
      const semesterSelect = document.getElementById("semester-select");

      semesterSelect.addEventListener("change", function () {
        const selectedSemester = this.value;
        displaySemesterData(selectedSemester);
      });

      showMarksBtn.addEventListener("click", async () => {
        errorMessage.style.display = "none";

        const scholarNo = document.getElementById("scholar-no").value;
        const password = document.getElementById("password").value;
        let jwtToken = document.getElementById("jwt-token").value;

        if (!jwtToken && (!scholarNo || !password)) {
          errorMessage.textContent =
            "Please provide either login credentials or JWT token";
          errorMessage.style.display = "block";
          return;
        }

        showMarksBtn.classList.add("btn-loading");
        loadingBar.style.width = "30%";

        try {
          if (!jwtToken) {
            loadingBar.style.width = "50%";

            const loginResponse = await fetch(
              "https://erpapi.manit.ac.in/api/login",
              {
                method: "POST",
                headers: {
                  "Content-Type": "application/json",
                },
                body: JSON.stringify({
                  username: scholarNo,
                  password: password,
                }),
              }
            );

            if (!loginResponse.ok) {
              throw new Error("Login failed. Please check your credentials.");
            }

            const loginData = await loginResponse.json();
            jwtToken = loginData.token;
          }

          loadingBar.style.width = "70%";

          const data = jwtToken.split(".")[1];
          const studentuid = JSON.parse(atob(data)).studentuid;
          const resultResponse = await fetch(
            "https://erpapi.manit.ac.in/api/student_result",
            {
              method: "POST",
              headers: {
                Authorization: `Bearer ${jwtToken}`,
                "Content-Type": "application/json",
              },
              body: JSON.stringify({
                studentuid: 9055,
                programID: 80,
              }),
            }
          );

          if (!resultResponse.ok) {
            throw new Error("Failed to fetch results. Please try again.");
          }

          loadingBar.style.width = "90%";

          const resultData = await resultResponse.json();
          document.getElementById("scholar-no").value = "";
          document.getElementById("password").value = "";
          document.getElementById("jwt-token").value = "";

          allResultData = resultData;

          populateSemesterDropdown(resultData);

          if (
            resultData.data.Semester_Data &&
            resultData.data.Semester_Data.length > 0
          ) {
            displayResults(resultData);
          }

          loadingBar.style.width = "100%";
          setTimeout(() => {
            showMarksBtn.classList.remove("btn-loading");
            loadingBar.style.width = "0%";
          }, 500);
        } catch (error) {
          console.error("Error:", error);
          errorMessage.textContent =
            error.message || "An unexpected error occurred. Please try again.";
          errorMessage.style.display = "block";

          showMarksBtn.classList.remove("btn-loading");
          loadingBar.style.width = "0%";
        }
      });

      document.getElementById("print-btn").addEventListener("click", () => {
        window.print();
      });

      function populateSemesterDropdown(resultData) {
        semesterSelect.innerHTML = "";

        if (resultData.data && resultData.data.Semester_Data) {
          const semesterData = resultData.data.Semester_Data;

          semesterData.forEach((semester, index) => {
            const option = document.createElement("option");
            option.value = index;
            option.textContent =
              semester.data.semester_term || `Semester ${index + 1}`;
            semesterSelect.appendChild(option);
          });
        }
      }

      function displaySemesterData(semesterIndex) {
        if (
          allResultData &&
          allResultData.data &&
          allResultData.data.Semester_Data
        ) {
          const semesterData = allResultData.data.Semester_Data[semesterIndex];
          if (semesterData) {
            updateResultsDisplay(semesterData);
          }
        }
      }

      function updateResultsDisplay(semesterData) {
        const data = semesterData.data;
        const bd = allResultData.data.Basic_Details[0];
        const total = data.grand_total;

        const marksTableBody = document.getElementById("marks-table-body");
        marksTableBody.innerHTML = "";

        data.subjects.forEach((subject) => {
          const row = document.createElement("tr");
          const gradeClass = `grade-${subject.grade.charAt(0)}`;

          row.innerHTML = `
            <td>${subject.subname}</td>
            <td>${subject.marks_obtained}/${subject.total_marks}</td>
            <td>${subject.mid_term_marks}/${subject.total_mid_term_marks}</td>
            <td>${subject.end_term_marks}/${subject.total_end_term_marks}</td>
            <td class="${gradeClass}">${subject.grade}</td>
          `;

          marksTableBody.appendChild(row);
        });

        const summary = document.getElementById("summary");
        summary.innerHTML = `
          <p><strong>Grand Total:</strong> ${total.marks_obtained}/${total.total_marks}</p>
          <p><strong>SGPA:</strong> ${total.sgpa}</p>
        `;
      }

      function displayResults(data) {
        const bd = data.data.Basic_Details[0];
        const firstSemesterData = data.data.Semester_Data[0].data;

        const studentInfo = document.getElementById("student-info");
        studentInfo.innerHTML = `
          <h3>Student Report Card</h3>
          <p><strong>Name:</strong> ${bd.full_name}</p>
          <p><strong>Scholar No:</strong> ${bd.roll_no}</p>
          <p><strong>Branch:</strong> ${bd.department_name}</p>
        `;

        updateResultsDisplay(data.data.Semester_Data[0]);

        reportCard.style.display = "block";

        reportCard.scrollIntoView({ behavior: "smooth" });
      }
    </script>
  </body>
</html>
